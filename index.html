<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Discovery Dispute Management Dashboard</title>
    <link rel="stylesheet" href="src/renderer/css/styles.css">
</head>
<body>
    <!-- Replace the theme toggle button with the new menu system -->
    <div class="menu-container">
        <div class="menu-items">
            <button class="menu-item" onclick="showUserInfo()" title="User Information">
                <svg viewBox="0 0 24 24">
                    <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 3c1.66 0 3 1.34 3 3s-1.34 3-3 3-3-1.34-3-3 1.34-3 3-3zm0 14.2c-2.5 0-4.71-1.28-6-3.22.03-1.99 4-3.08 6-3.08 1.99 0 5.97 1.09 6 3.08-1.29 1.94-3.5 3.22-6 3.22z"/>
                </svg>
            </button>
            <button class="menu-item" onclick="toggleTheme()" title="Toggle theme">
                <svg id="theme-icon" viewBox="0 0 24 24">
                    <!-- Moon icon (for light mode) -->
                    <path class="moon-icon" d="M21.53 15.93c-.16-.27-.61-.69-1.73-.49a8.46 8.46 0 01-1.88.13 8.409 8.409 0 01-5.91-2.82 8.068 8.068 0 01-1.44-8.66c.44-1.01.13-1.54-.09-1.76s-.77-.55-1.83-.11a10.318 10.318 0 00-6.32 10.21 10.475 10.475 0 007.04 8.99 10 10 0 002.89.55c.16.01.32.02.48.02a10.5 10.5 0 008.47-4.27c.67-.93.49-1.519.32-1.79z"/>
                    <!-- Sun icon (for dark mode) -->
                    <path class="sun-icon" d="M12 7c-2.76 0-5 2.24-5 5s2.24 5 5 5 5-2.24 5-5-2.24-5-5-5zM2 13h2c.55 0 1-.45 1-1s-.45-1-1-1H2c-.55 0-1 .45-1 1s.45 1 1 1zm18 0h2c.55 0 1-.45 1-1s-.45-1-1-1h-2c-.55 0-1 .45-1 1s.45 1 1 1zM11 2v2c0 .55.45 1 1 1s1-.45 1-1V2c0-.55-.45-1-1-1s-1 .45-1 1zm0 18v2c0 .55.45 1 1 1s1-.45 1-1v-2c0-.55-.45-1-1-1s-1 .45-1 1zM5.99 4.58a.996.996 0 00-1.41 0 .996.996 0 000 1.41l1.06 1.06c.39.39 1.03.39 1.41 0s.39-1.03 0-1.41L5.99 4.58zm12.37 12.37a.996.996 0 00-1.41 0 .996.996 0 000 1.41l1.06 1.06c.39.39 1.03.39 1.41 0a.996.996 0 000-1.41l-1.06-1.06zm1.06-10.96a.996.996 0 000-1.41.996.996 0 00-1.41 0l-1.06 1.06c-.39.39-.39 1.03 0 1.41s1.03.39 1.41 0l1.06-1.06zM7.05 18.36a.996.996 0 000-1.41.996.996 0 00-1.41 0l-1.06 1.06c-.39.39-.39 1.03 0 1.41s1.03.39 1.41 0l1.06-1.06z"/>
                </svg>
            </button>
        </div>
        <button class="menu-toggle" onclick="toggleMenu()" title="Menu">
            <svg viewBox="0 0 24 24" width="24" height="24">
                <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z" fill="currentColor"/>
            </svg>
        </button>
    </div>

    <!-- VIEW 1: CASES DASHBOARD -->
    <div id="cases-dashboard-view">
        <div class="container">
            <header style="display: flex; justify-content: space-between; align-items: center;">
                <div>
                    <h1>All Cases</h1>
                    <h2>Select a case to view its discovery disputes.</h2>
                </div>
                <button class="btn btn-primary">Add New Case</button>
            </header>
            <div id="cases-grid"></div>
        </div>
    </div>

    <!-- VIEW 2: REQUEST LETTERS MENU -->
    <div id="request-letters-view">
        <div class="container">
            <header>
                <h1 id="request-letters-header">Case Name</h1>
                <h2>Select a request letter to analyze.</h2>
            </header>
            <div class="action-bar">
                <button class="btn btn-secondary" data-action="back-to-cases">← Back to All Cases</button>
                <button class="btn btn-upload" data-action="upload-request">Upload New Request Letter</button>
            </div>
            <div class="progress-section" id="request-progress-section">
                <div id="request-status-bar" class="status-bar"></div>
                <div id="request-progress-container" class="progress-container">
                    <div id="request-progress-bar" class="progress-bar"></div>
                </div>
            </div>
            <div class="table-container">
                <table class="dispute-table">
                    <thead>
                        <tr>
                            <th style="width: 20%">Date Added</th>
                            <th style="width: 50%">Description</th>
                            <th style="width: 15%">Requests</th>
                            <th style="width: 15%">Status</th>
                        </tr>
                    </thead>
                    <tbody id="request-letters-table"></tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- VIEW 3: DISPUTE LIST (FOR A SINGLE REQUEST LETTER) -->
    <div id="dispute-list-view">
        <div class="container">
            <header>
                <h1 id="case-name-header">Case Name</h1>
                <h2 id="case-subtitle">Manage discovery disputes for this case.</h2>
            </header>
            <div class="action-bar">
                <button class="btn btn-secondary" data-action="back-to-letters">← Back to Request Letters</button>
                <button class="btn btn-upload" data-action="upload">Upload Opponent's Response</button>
                <button class="btn btn-action" data-action="generate-all">Generate All Pending Replies</button>
                <button class="btn btn-primary" data-action="build-letter">Build Response Letter</button>
            </div>
            <div class="progress-section" id="dispute-progress-section">
                <div id="dispute-status-bar" class="status-bar"></div>
                <div id="dispute-progress-container" class="progress-container">
                    <div id="dispute-progress-bar" class="progress-bar"></div>
                </div>
            </div>
            <div class="table-container">
                <table class="dispute-table">
                    <thead>
                        <tr>
                            <th class="col-number">#</th>
                            <th class="col-request">Your Request (Summary)</th>
                            <th class="col-objection">Opponent's Objection</th>
                        </tr>
                    </thead>
                    <tbody id="table-body"></tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- VIEW 4: FOCUS VIEW -->
    <div id="focus-view">
        <div class="focus-container">
            <div class="focus-header">
                <button data-action="back-to-list" class="btn btn-secondary">← Back to Dispute List</button>
                <h3 id="focus-title">Request X of Y</h3>
                <div>
                    <button data-action="focus-prev" class="btn btn-primary">‹</button>
                    <button data-action="focus-next" class="btn btn-primary">›</button>
                </div>
            </div>
            <div class="focus-content-grid">
                <!-- Left Column: Request and Objection -->
                <div class="focus-col">
                    <div class="request-section">
                        <h4>Request</h4>
                        <div id="focus-request-text" style="margin-top: 12px;"></div>
                    </div>
                    <div class="objection-section">
                        <h4>Opponent's Objection</h4>
                        <textarea id="focus-objection-textarea" style="width: 100%; font-family: inherit; font-size: 1rem; line-height: 1.6; color: var(--text-primary); background: var(--surface-primary); border: 1px solid var(--border-light); border-radius: 6px; padding: 12px; margin-top: 12px; min-height: 200px; resize: vertical;"></textarea>
                    </div>
                </div>
                
                <!-- Right Column: AI-Generated Replies -->
                <div class="focus-col">
                    <div class="replies-section">
                        <div class="replies-header">
                            <div class="replies-header-left">
                                <h4>AI-Generated Replies</h4>
                                <div class="autosave-indicator">
                                    <span class="icon"></span>
                                    <span class="text">Changes saved</span>
                                </div>
                            </div>
                            <button data-action="focus-generate" class="btn btn-action">Generate</button>
                        </div>
                        <div id="focus-reply-editor" class="replies-content" contenteditable="true"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- VIEW 5: RESPONSE LETTER EDITOR -->
    <div id="response-letter-editor-view">
        <div class="container">
            <header>
                <h1 id="letter-editor-header">Response Letter Editor</h1>
                <h2 id="letter-editor-subtitle"></h2>
            </header>
            
            <div class="action-bar">
                <button class="btn btn-secondary" data-action="back-to-disputes">← Back to Disputes</button>
                <button class="btn btn-action" data-action="generate-letter">Build Response Letter</button>
            </div>

            <div class="letter-editor-grid">
                <!-- Left Column: Statistics and Controls -->
                <div class="letter-stats-panel">
                    <div class="stats-card">
                        <h3>Document Statistics</h3>
                        <div class="stat-item">
                            <span class="stat-label">Total Requests:</span>
                            <span id="stat-total-requests" class="stat-value">0</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">With Objections:</span>
                            <span id="stat-with-objections" class="stat-value">0</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">With Responses:</span>
                            <span id="stat-with-responses" class="stat-value">0</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Pending Responses:</span>
                            <span id="stat-pending" class="stat-value">0</span>
                        </div>
                    </div>

                    <div class="generation-progress" style="display: none;">
                        <h3>Generation Progress</h3>
                        <div class="progress-stages">
                            <div class="progress-stage" data-stage="setup">
                                <span class="stage-dot"></span>
                                <span class="stage-label">Setting Up</span>
                            </div>
                            <div class="progress-stage" data-stage="header">
                                <span class="stage-dot"></span>
                                <span class="stage-label">Generating Header</span>
                            </div>
                            <div class="progress-stage" data-stage="body">
                                <span class="stage-dot"></span>
                                <span class="stage-label">Processing Requests</span>
                            </div>
                            <div class="progress-stage" data-stage="conclusion">
                                <span class="stage-dot"></span>
                                <span class="stage-label">Adding Conclusion</span>
                            </div>
                            <div class="progress-stage" data-stage="formatting">
                                <span class="stage-dot"></span>
                                <span class="stage-label">Final Formatting</span>
                            </div>
                        </div>
                        <div class="progress-container">
                            <div class="progress-bar"></div>
                        </div>
                        <div class="progress-status">Initializing...</div>
                    </div>
                </div>

                <!-- Right Column: PDF Preview -->
                <div class="letter-preview-panel">
                    <div class="preview-toolbar">
                        <div class="preview-controls">
                            <button class="btn btn-secondary" onclick="zoomIn()">
                                <svg width="16" height="16" viewBox="0 0 16 16">
                                    <path d="M8 4v8M4 8h8" stroke="currentColor" stroke-width="2"/>
                                </svg>
                            </button>
                            <button class="btn btn-secondary" onclick="zoomOut()">
                                <svg width="16" height="16" viewBox="0 0 16 16">
                                    <path d="M4 8h8" stroke="currentColor" stroke-width="2"/>
                                </svg>
                            </button>
                            <span id="zoom-level">100%</span>
                        </div>
                        <div class="export-controls">
                            <button class="btn btn-secondary" onclick="exportLetter('pdf')">Export PDF</button>
                            <button class="btn btn-secondary" onclick="exportLetter('docx')">Export DOCX</button>
                        </div>
                    </div>
                    <div id="letter-preview-container">
                        <div id="letter-preview-content"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- MODALS -->
    <div class="modal-overlay" id="add-case-modal">
        <div class="modal">
            <div class="modal-header">
                <h3>Add New Case</h3>
                <button class="modal-close" onclick="hideAddCaseModal()">×</button>
            </div>
            <div class="modal-body">
                <div class="input-group">
                    <label for="case-name-input">Case Name</label>
                    <input type="text" id="case-name-input" placeholder="Enter case name...">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="hideAddCaseModal()">Cancel</button>
                <button class="btn btn-primary">Create Case</button>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="edit-case-modal">
        <div class="modal">
            <div class="modal-header">
                <h3>Edit Case Name</h3>
                <button class="modal-close" onclick="hideEditCaseModal()">×</button>
            </div>
            <div class="modal-body">
                <div class="input-group">
                    <label for="edit-case-name-input">Case Name</label>
                    <input type="text" id="edit-case-name-input">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="hideEditCaseModal()">Cancel</button>
                <button class="btn btn-primary" onclick="saveEditedCase()">Save Changes</button>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="edit-letter-modal">
        <div class="modal">
            <div class="modal-header">
                <h3>Edit Request Letter Name</h3>
                <button class="modal-close" onclick="hideEditLetterModal()">×</button>
            </div>
            <div class="modal-body">
                <div class="input-group">
                    <label for="edit-letter-name-input">Request Letter Name</label>
                    <input type="text" id="edit-letter-name-input">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="hideEditLetterModal()">Cancel</button>
                <button class="btn btn-primary" onclick="saveEditedLetter()">Save Changes</button>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="response-letter-modal">
        <div class="modal" style="max-width: 80%; height: 80vh; display: flex; flex-direction: column;">
            <div class="modal-header">
                <h3>Discovery Response Letter</h3>
                <div>
                    <button class="btn btn-secondary" onclick="exportResponseLetter('docx')">Export as DOCX</button>
                    <button class="btn btn-secondary" onclick="exportResponseLetter('pdf')">Export as PDF</button>
                    <button class="modal-close" onclick="hideResponseLetterModal()">×</button>
                </div>
            </div>
            <div class="modal-body" style="flex-grow: 1; overflow: auto; margin-bottom: 0;">
                <div id="letter-editor" contenteditable="true" style="width: 100%; height: 100%; padding: 20px; font-family: 'Times New Roman', Times, serif; font-size: 12pt; line-height: 1.5; white-space: pre-wrap;">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="hideResponseLetterModal()">Close</button>
                <button class="btn btn-primary" onclick="saveResponseLetter()">Save Draft</button>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="version-history-modal">
        <div class="modal">
            <div class="modal-header">
                <h3>Version History</h3>
                <button class="modal-close" onclick="hideVersionHistoryModal()">×</button>
            </div>
            <div class="modal-body">
                <div id="version-list"></div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="hideVersionHistoryModal()">Close</button>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="preview-modal">
        <div class="modal letter-modal">
            <div class="modal-header">
                <h3 id="preview-modal-title">Preview Version</h3>
                <button class="modal-close" onclick="hidePreviewModal()">×</button>
            </div>
            <div class="modal-body">
                <div class="letter-preview-container">
                    <div id="preview-content" class="letter-preview-content"></div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="hidePreviewModal()">Close</button>
            </div>
        </div>
    </div>

    <!-- VIEW 6: USER PROFILE -->
    <div id="user-profile-view">
        <div class="container">
            <header>
                <h1>User Profile</h1>
                <h2>Manage your personal information and preferences</h2>
            </header>
            
            <div class="action-bar">
                <button class="btn btn-secondary" data-action="back-to-previous">← Back</button>
                <button id="save-profile-btn" class="btn btn-primary" onclick="saveUserProfile()">Save Changes</button>
                <span id="profile-status-text" style="color: var(--text-secondary); margin-left: 16px;"></span>
            </div>

            <div class="profile-grid">
                <!-- Personal Information Section -->
                <div class="profile-section">
                    <h3>Personal Information</h3>
                    <div class="form-group">
                        <label for="profile-name">Full Name</label>
                        <input type="text" id="profile-name" class="form-input" placeholder="Enter your full name">
                    </div>
                    <div class="form-group">
                        <label for="profile-title">Job Title</label>
                        <input type="text" id="profile-title" class="form-input" placeholder="Enter your job title">
                    </div>
                    <div class="form-group">
                        <label for="profile-email">Email Address</label>
                        <input type="email" id="profile-email" class="form-input" placeholder="Enter your email address">
                    </div>
                    <div class="form-group">
                        <label for="profile-phone">Phone Number</label>
                        <input type="tel" id="profile-phone" class="form-input" placeholder="Enter your phone number">
                    </div>
                    <div class="form-group">
                        <label for="profile-api-key">Gemini API Key</label>
                        <input type="password" id="profile-api-key" class="form-input" placeholder="Enter your Gemini API Key">
                        <p class="help-text">Your key is stored locally and is never shared.</p>
                    </div>
                </div>

                <!-- Organization Section -->
                <div class="profile-section">
                    <h3>Organization Details</h3>
                    <div class="form-group">
                        <label for="profile-org">Organization Name</label>
                        <input type="text" id="profile-org" class="form-input" placeholder="Enter your organization name">
                    </div>
                    <div class="form-group">
                        <label for="profile-org-address">Organization Address</label>
                        <textarea id="profile-org-address" class="form-input" rows="3" placeholder="Enter your organization's address"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="profile-bar-number">Bar Number</label>
                        <input type="text" id="profile-bar-number" class="form-input" placeholder="Enter your bar number">
                    </div>
                </div>

                <!-- Signature Section -->
                <div class="profile-section">
                    <h3>Signature Block</h3>
                    <div class="form-group">
                        <label for="profile-signature">Default Signature Block</label>
                        <textarea id="profile-signature" class="form-input" rows="5" placeholder="Enter your default signature block for letters"></textarea>
                    </div>
                    <p class="help-text">This signature block will be automatically added to generated letters.</p>
                </div>

                <!-- System Information -->
                <div class="profile-section">
                    <h3>System Information</h3>
                    <div class="info-group">
                        <label>Workspace Path</label>
                        <div class="info-value" id="workspace-path"></div>
                    </div>
                    <div class="info-group">
                        <label>Operating System</label>
                        <div class="info-value" id="os-info"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Load the modular JavaScript -->
    <script type="module" src="src/renderer/js/app.js"></script>

    <!-- Legacy functions for backward compatibility during transition -->
    <script>
        // Temporary compatibility functions - these will be removed once migration is complete
        function showUserInfo() {
            if (window.app && window.app.viewManager) {
                window.app.viewManager.showUserProfile();
            }
        }

        function toggleTheme() {
            const body = document.body;
            const currentTheme = body.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            body.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);
            updateThemeIcon(newTheme);
        }

        function updateThemeIcon(theme) {
            const moonIcon = document.querySelector('.moon-icon');
            const sunIcon = document.querySelector('.sun-icon');
            if (theme === 'dark') {
                moonIcon.style.display = 'none';
                sunIcon.style.display = 'block';
            } else {
                moonIcon.style.display = 'block';
                sunIcon.style.display = 'none';
            }
        }

        function toggleMenu() {
            const menuContainer = document.querySelector('.menu-container');
            const menuToggle = document.querySelector('.menu-toggle');
            menuContainer.classList.toggle('active');
            menuToggle.classList.toggle('active');
        }

        // Initialize theme from saved preference
        document.addEventListener('DOMContentLoaded', () => {
            const savedTheme = localStorage.getItem('theme') || 'light';
            document.body.setAttribute('data-theme', savedTheme);
            updateThemeIcon(savedTheme);
        });

        // Placeholder functions for modals and other features
        function showAddCaseModal() { /* TODO: Implement */ }
        function hideAddCaseModal() { /* TODO: Implement */ }
        function createNewCase() { /* TODO: Implement */ }
        function showEditCaseModal() { /* TODO: Implement */ }
        function hideEditCaseModal() { /* TODO: Implement */ }
        function saveEditedCase() { /* TODO: Implement */ }
        function showEditLetterModal() { /* TODO: Implement */ }
        function hideEditLetterModal() { /* TODO: Implement */ }
        function saveEditedLetter() { /* TODO: Implement */ }
        function showResponseLetterModal() { /* TODO: Implement */ }
        function hideResponseLetterModal() { /* TODO: Implement */ }
        function saveResponseLetter() { /* TODO: Implement */ }
        function exportResponseLetter() { /* TODO: Implement */ }
        function showVersionHistoryModal() { /* TODO: Implement */ }
        function hideVersionHistoryModal() { /* TODO: Implement */ }
        function hidePreviewModal() { /* TODO: Implement */ }
        function saveUserProfile() { /* TODO: Implement */ }
        function zoomIn() { /* TODO: Implement */ }
        function zoomOut() { /* TODO: Implement */ }
        function exportLetter() { /* TODO: Implement */ }
    </script>
</body>
</html>